# DFL-AA: Delta Aggregation for Mobile Decentralized Federated Learning over Lossy Links

Welcome to the code base for DFL-AA Simulator...

To get start with, install all the requirements listed down in the `requirements.txt`. Then follow each step to generate `1. Mobility Traces for given number of nodes`, `2. Split down data set among participating nodes`, `3. Run base experiments setup`, `4. Test for other scenarios`, and finaly generate the illustrations from the results. Please make sure to use exact same locations used in the code or change as you wanted with extra care !!!!

### Generate Mobility Traces for Given Nodes, Given area and Given Timespan: 

``` bash
python road_flow_ou_switch_mobility.py \
    --nodes 20 --area_m 2000 --duration_s 3000 --dt_s 1 \
    --num_flows 4 --flow_heading_mode paired --flow_heading_deg 0 --flow_heading_spread_deg 90 \
    --flow_speed_kmph 35 --flow_speed_spread_kmph 8 \
    --tau_rel_s 600 --sigma_rel_mps 0.25 \
    --tau_switch_s 900 --switch_mode adjacent \
    --speed_scale 0.7 --boundary reflect --out_csv mobility.csv \
    --analyze_radius_m 400 --analyze_delta_s 60
```

#### Additionally, if you want to generate a GIF showing node behaviors according to mobility traces, you can run the following script.

``` bash
python mobility_to_graph.py \
    --csv_path mobility.csv \
    --radius_m 500 \
    --area_m 2000 \
    --fps 10 \
    --out_gif network.gif
```

### Create a data partitioning according to the nodes

``` bash
python data_loader.py \
    --datasets mnist,fmnist,cifar10 \
    --alphas 0.1,0.5,1.0 \
    --num-clients 20 \
    --split non_iid_dirichlet \
    --out-root dataset_partitions \
    --seed 42
```


### Script for core experiments for given datasets + algorithm. All results can be found at specified location

``` bash
python run_all_exp.py \
    --partitions-root dataset_partitions \
    --partition-pattern "{root}/{dataset}/alpha_{alpha_tag}" \
    --datasets mnist,fmnist,cifar10 \
    --alphas 0.1,0.5,1.0 \
    --aggregations fedavg,softSGD,dflaa
```

#### Note: If you want to check scalability, just need to increase the number of nodes in the command and run the same script. (You may assign resources effectively according to your machine if you change node count)


#### Note: If you want to change the packet loss rates and recheck for the results, simple change the network initial parameters in dfl_core.py file and rerun the same command listed above for experiments.


#### Note: If you want to evaluate DFL-AA under different `tau` value ranges, please change the `tau` value in the run_all_exp.py file and rerun the same command (only with DFL-AA as aggregation)


### Script for component-wise evaluation for DFL-AA with specific aggregation scheme

``` bash
python run_all_exp_abl.py \
    --partitions-root dataset_partitions \
    --partition-pattern "{root}/{dataset}/alpha_{alpha_tag}" \
    --datasets mnist \
    --alphas 0.1,0.5 \
    --aggregations softSGD_s,softGSD_c,dflaa_s,dflaa_c
```




### To finally generate the images related to experiments, please do the following actions for 1) main results 2) ablation/component wise

### 1)

```bash
python main_results.py \
    --results-root all_exp_results \
    --datasets mnist,fmnist \
    --alphas 1.0,0.5,0.1 \
    --aggregations fedavg,softSGD,dflaa \
    --out-dir icdcs_paper_results \
    --tables-out ICDCS_tables.txt
```

### 2)

``` bash
python main_results_comp_abl.py \
    --root ablation_results \
    --dataset mnist \
    --alpha 0.1,0.5 \
    --aggregations dflaa,dflaa_s,dflaa_c,softSGD,softGSD_c \
    --out-dir icdcs_paper_results
```



#### Note: For any specific results which are generated by altering core files as wanted. Please use main_results.py file's core concepts and pass correct results location


